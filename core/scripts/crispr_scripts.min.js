let gene_backgroundInfo,benchling_grna_outputs,selection_inMode="practice",possible_gene="eBFP",current_gene="empty";function ModeSelectionAdd(t){let e;if($("#gene_dropdown_selection").empty(),document.getElementById("load_button")?.disabled,"practice"===t)e='<option value="eBFP" id="eBFP" tag="practice">eBFP</option>\n',e+='<option value="ACTN3" id="ACTN3" tag="practice">ACTN3</option>\n',$("#gene_dropdown_selection").append(e);else if("assignment"===t){const t=removeCompletedAssignments();for(let n=0;n<t.length;n+=1)0===n?e=`<option value="${t[n]}" id="${t[n]}" tag="assignment">${t[n]}</option>\n`:e+=`<option value="${t[n]}" id="${t[n]}" tag="assignment">${t[n]}</option>\n`;$("#gene_dropdown_selection").append(e)}}function select_Gene(){""!==possible_gene||possible_gene?(current_gene=possible_gene,loadWork(),checkAnswers_executed=!1):("empty"===current_gene&&"eBFP"===current_gene&&"ACTN3"===current_gene&&"HBB"===current_gene&&"CCR5"===current_gene&&"ANKK1"===current_gene&&"APOE"===current_gene||(current_gene="empty"),alert("Error code sG34-42 occurred. Please contact admin or TA!"))}function loadCRISPRJSON_Files(){const t=new stitch.StitchClient("almark-wvohf"),e=t.service("mongodb","mongodb-atlas").db("AlMark");t.login().then((()=>e.collection("Gene_Information").find({version:"0.3"}).limit(100).execute())).then((t=>{gene_backgroundInfo=t})).catch((t=>{console.error(t)})),t.login().then((()=>e.collection("Benchling_gRNA_Outputs").find({version:"0.2"}).limit(100).execute())).then((t=>{benchling_grna_outputs=t})).catch((t=>{console.error(t)}))}let list_of_practice=["eBFP"],list_of_assignments=["CCR5"];function fillGeneList(t=0){if(list_of_practice=[],list_of_assignments=[],t<100)if(gene_backgroundInfo||""!==gene_backgroundInfo)if(gene_backgroundInfo[0]){const t=Object.keys(gene_backgroundInfo[0].gene_list);for(const e of t)"practice"===gene_backgroundInfo[0].gene_list[e].base_type?list_of_practice.push(e):"assignment"===gene_backgroundInfo[0].gene_list[e].base_type&&list_of_assignments.push(e)}else setTimeout((()=>{fillGeneList(t+1)}),500);else setTimeout((()=>{fillGeneList(t+1)}),500);else alert("Error code geneList-113 occurred. Please contact admin or TA!")}let loadedMode="practice";function loadWork(){if(gene_backgroundInfo||""!==gene_backgroundInfo||backgroundInfo[0].gene_list[current_gene]){let t;$("#work").empty(),loadedMode=selection_inMode,checkAnswers_executed=!1,t='<div class="work_background" style="margin-top:2%;">',t+='<div id="crispr_header">\n<p>Please refer to your dry lab protocol for full instructions on how and what to do. Below is a brief reminder of what you are supposed to do with each gene: \n <b>Your objective is to find these mutations, design a gRNA and its corresponding F1/R1 primers</b></p> \n</div>\n',t+=`<div id="gene_info"><p>Here is some background information about your gene: ${gene_backgroundInfo[0].gene_list[current_gene].name} (${current_gene})</p>\n`,t+=`<p> Background information: ${gene_backgroundInfo[0].gene_list[current_gene].Background}</p>\n`,t+=`<p> Target site: ${gene_backgroundInfo[0].gene_list[current_gene]["Target site"]}</p>\n`,t+=`<p style="word-wrap:break-word;"> Modified genetic sequence: ${gene_backgroundInfo[0].gene_list[current_gene].Sequence}</p>\n`,t+="</div>",t+="</div>",t+='<div id="work_section">',t+="<p> Please input the following information for your gRNA for your selected gene.</p>\n",t+="<form>",t+='<div class="form-group">',t+='<label for="sequence_input">gRNA Sequence:</label>',t+='<input class="form-control" id="sequence_input" placeholder="CTCGTGACCACCCTGACCCA" maxlength="20" required>',t+='<small id="sequence_inputSmall" class="form-text text-muted">This would be your gRNA sequence 5\' to 3\'. NOTE: This is maxed out at 20 characters long</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="pam_input">PAM Sequence:</label>',t+='<input class="form-control" id="pam_input" placeholder="CGG" maxlength="3" required>',t+='<small id="pam_inputSmall" class="form-text text-muted">This would be your PAM sequence 5\' to 3\'. NOTE: This is maxed out at 3 characters long</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="position_input">Cut position:</label>',t+='<input class="form-control" id="position_input" placeholder="380" type="number" required>',t+='<small id="position_inputSmall" class="form-text text-muted">This would be your cut position for your gRNA. NOTE: This input only takes numbers</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="strand_input">gRNA Strand:</label>',t+='<select class="form-control" id="strand_input"><option>Antisense (-)</option><option>Sense (+)</option></select>',t+='<small id="strand_inputSmall" class="form-text text-muted">This would be for which strand your gRNA is on.</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="offtarget_input">Off-target score:</label>',t+='<input class="form-control" id="offtarget_input" placeholder="60.7" step="0.01" type="number" required>',t+='<small id="position_inputSmall" class="form-text text-muted">This would be your off-target score for your gRNA. NOTE: This input only takes numbers</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="f1_input">F1 Primers:</label>',t+='<input class="form-control" id="f1_input" placeholder="TAATACGACTCACTATAGCTCGTGACCACCCTGA" required>',t+='<small id="f1_inputSmall" class="form-text text-muted">This would be your forward primer (F1) for your gRNA</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="r1_input">R1 Primers:</label>',t+='<input class="form-control" id="r1_input" placeholder="TTCTAGCTCTAAAACTGGGTCAGGGTGGTCACGAG" required>',t+='<small id="r1_inputSmall" class="form-text text-muted">This would be your reverse primer (R1) for your gRNA</small>',t+="</div>",t+='<button type="button" class="btn btn-success" style="margin:1%;" hidden>Save</button>',t+='<button id="assignmentSubmitButton" type="button" class="btn btn-primary" style="margin:1%;" onclick="submitAnswers();">Submit</button>',t+="</form>",t+="</div>",$("#work").append(t)}else""!==gene_backgroundInfo&&gene_backgroundInfo&&backgroundInfo[0].gene_list[current_gene]||alert("Error code lFS50-66 occurred. Please contact admin or TA!")}function isNumberOrDashKey(t){const e=t.which?t.which:t.keyCode;return!(46!==e&&45!==e&&e>31&&(e<48||e>57))}let MARgRNAseq=!1,MARgRNAseq_degree=0,MARPAMseq=!1,MARCutPos=!1,MARstrand=!1,MAROffTarget=!1,MAROffTarget_degree=0,MAROffTarget_aboveOpt=!1,MAROffTarget_above35=!1,MAROffTarget_onlyOption=!1,MARF1primers=!1,MARR1primers=!1,possible_comparable_answers=[],correctNucleotideIncluded=!1,true_counts=0,checkAnswers_executed=!1;function checkAnswers(){MARgRNAseq=!1,MARgRNAseq_degree=0,MARPAMseq=!1,MARCutPos=!1,MARstrand=!1,correctNucleotideIncluded=!1,true_counts=0;const t=gene_backgroundInfo[0].gene_list[current_gene]["Target position"]-1,e=document.getElementById("sequence_input").value.trim();possible_comparable_answers=[];for(const n of benchling_grna_outputs[0].gene_list[current_gene])n.Sequence===e&&possible_comparable_answers.push(n);if(possible_comparable_answers.length>0)for(const n of possible_comparable_answers){if(true_counts=0,correctNucleotideIncluded=!1,1===n.Strand){const e=n.Position-1-1+3;t>=n.Position-1-17&&t<=e&&(correctNucleotideIncluded=!0)}else if(-1===n.Strand){const e=n.Position-1+17;t>=n.Position-1-3&&t<=e&&(correctNucleotideIncluded=!0)}if(correctNucleotideIncluded){let e,s;if(1===n.Strand?(e=n.Position-1+2,s=n.Position-1+4,"Sense (+)"===document.getElementById("strand_input").value&&(MARstrand=!0,true_counts+=1)):-1===n.Strand&&(e=n.Position-1-2,s=n.Position-1-4,"Antisense (-)"===document.getElementById("strand_input").value&&(MARstrand=!0,true_counts+=1)),t>=e&&t<=s?(MARgRNAseq=!1,MARgRNAseq_degree=0):t>=element.Position-1+1&&t<=element.Position-1+10||t<=element.Position-1-1&&t>=element.Position-1-10?(MARgRNAseq=!0,MARgRNAseq_degree=1,true_counts+=1):t>=element.Position-1&&t<=element.Position-1+20||t<=element.Position-1&&t>=element.Position-1-20?(MARgRNAseq=!0,MARgRNAseq_degree=2,true_counts+=1):(t>=element.Position-1&&t<=element.Position-1+30||t<=element.Position-1&&t>=element.Position-1-30)&&(MARgRNAseq=!0,MARgRNAseq_degree=3,true_counts+=1),MARgRNAseq){const t=element;t.Position&&parseInt(t.Position,10)===parseInt(document.getElementById("position_input").value,10)?(MARCutPos=!0,true_counts+=1):null!==t.Position&&void 0!==t.Position||alert("Error code cA302-307: retrieving server information on 'Position' answers occurred. Please contact admin or TA!"),(t.PAM||t.PAM)&&t.PAM===document.getElementById("pam_input").value.trim()?(MARPAMseq=!0,true_counts+=1):null!==t.PAM&&void 0!==t.PAM||alert("Error code cA311-317: retrieving server information on 'PAM' answers occurred. Please contact admin or TA!"),t["Specificity Score"]||t["Specificity Score"]?checkOffTarget(t["Specificity Score"]):null!==t["Specificity Score"]&&void 0!==t["Specificity Score"]||alert("Error code cA342-348: retrieving server information on 'Specificity Score' answers occurred. Please contact admin or TA!"),checkF1Primers(document.getElementById("sequence_input").value.trim()),checkR1Primers(document.getElementById("sequence_input").value.trim())}}}checkAnswers_executed=!0}let offtarget_List=[],offtarget_dict={},offtarget_dictParse=[],offtarget_Use=[];function checkOffTarget(t){MAROffTarget=!1,MAROffTarget_degree=0,MAROffTarget_aboveOpt=!1,MAROffTarget_above35=!1,MAROffTarget_onlyOption=!1;const e=Math.floor(t),n=Math.ceil(t),s=parseInt(document.getElementById("offtarget_input").value,10);if(correctNucleotideIncluded&&MARgRNAseq&&s>=e&&s<=n&&(MAROffTarget=!0,true_counts+=1),MAROffTarget){const t=parseInt(document.getElementById("position_input").value,10)+35,e=parseInt(document.getElementById("position_input").value,10)-35;offtarget_List=[],offtarget_dict={},offtarget_dictParse=[],offtarget_Use=[];for(let s=0;s<benchling_grna_outputs[0].gene_list[current_gene].length;s+=1)benchling_grna_outputs[0].gene_list[current_gene][s].Position>=e&&benchling_grna_outputs[0].gene_list[current_gene][s].Position<=t&&benchling_grna_outputs[0].gene_list[current_gene][s]["Specificity Score"]&&(offtarget_List.push(benchling_grna_outputs[0].gene_list[current_gene][s]["Specificity Score"]),offtarget_dict[s]=benchling_grna_outputs[0].gene_list[current_gene][s]["Specificity Score"],offtarget_dictParse.push(s));let n=!0;Math.max.apply(null,offtarget_List)<35&&(n=!1);const o=Math.max.apply(null,offtarget_List),a=o-.2*o;let r=a;const{studentClass:l}=student_reg_information[0].student_list[studentParseNum];"Optimal"===student_reg_information[0].classMarkingMod[l][0]?(a>80||a<35)&&(r=80):r=student_reg_information[0].classMarkingMod[l][0],s>=r?(MAROffTarget_aboveOpt=!0,MAROffTarget_above35=!0,MAROffTarget_degree=1):s>=35?(MAROffTarget_above35=!0,MAROffTarget_degree=Math.max.apply(null,offtarget_List)<80?1:2):n||(MAROffTarget_onlyOption=!0,MAROffTarget_degree=3)}}let possible_F1_primers=[];function checkF1Primers(t){MARF1primers=!1,possible_F1_primers=[];const e="TAATACGACTCACTATAG";let n=!0;"G"===t[0]&&(n=!1);for(let s=16;s<=20;s+=1)possible_F1_primers.push(e+t.slice(0,s));if(!n)for(let s=16;s<=20;s+=1)possible_F1_primers.push(e+t.slice(1,s));possible_F1_primers.includes(document.getElementById("f1_input").value.trim())&&(MARF1primers=!0)}let possible_R1_primers=[];const complementary_nt_dict={A:"T",T:"A",C:"G",G:"C"};function checkR1Primers(t){MARR1primers=!1,possible_R1_primers=[];let e="";for(const n of t)e=complementary_nt_dict[n]+e;for(let n=19;n<=20;n+=1)possible_R1_primers.push("TTCTAGCTCTAAAAC"+e.slice(0,n));possible_R1_primers.includes(document.getElementById("r1_input").value.trim())&&(MARR1primers=!0)}function createComplementarySeq(t){let e="";for(const n of t)e=complementary_nt_dict[n]+e}let studentMark=0,studentMarkPercentage=0;const markTotal=10;function markAnswers(){studentMark=0,checkAnswers_executed||checkAnswers(),checkAnswers_executed&&(MARgRNAseq&&(1===MARgRNAseq_degree?studentMark+=2:2===MARgRNAseq_degree?studentMark+=1:3===MARgRNAseq_degree&&(studentMark+=.5)),MARPAMseq&&(studentMark+=2),MAROffTarget&&(1===MAROffTarget_degree?studentMark+=2:2===MAROffTarget_degree?studentMark+=1:3===MAROffTarget_degree&&(studentMark+=.5)),MARF1primers&&(studentMark+=2),MARR1primers&&(studentMark+=2),studentMarkPercentage=(studentMark/10*100).toFixed(2),studentMarkPercentage>100?studentMarkPercentage=100:studentMarkPercentage<0&&(studentMarkPercentage=0))}function showFeedback(){$("#mainContainer").empty();let t="<p style='font-weight:bold;'> You would only receive feedback on your practice attempts and not your final assignments.</p>";t+="<p> The assignment itself is marked out of 10 marks with 2 marks for each input excluding gRNA strand direction, cut position and target region range (these three values are used to calculate if you have the right answer or not which means they are still crucial that they are still correct).</p>",t+="<p> The following is the breakdown of what marks you would have received and why you would have gotten them: </p>",t+=`<p style='font-weight:bold;'>Mark: ${all_marks[0]}/10 (${all_marks[1]})</p>`;let e=0,n="Your gRNA sequence was wrong and not found in the Benchling gRNA outputs. Either you made a typo or this answer was not correct and did not contain the target cut site within an acceptable range.";MARgRNAseq&&(1===MARgRNAseq_degree?(e=2,n="This means your answer was correct and you received full marks."):2===MARgRNAseq_degree?(e=1,n="This means your sequence was partially correct as it contains the target sequence within a 20bp range but was not optimal. One mark."):3===MARgRNAseq_degree&&(e=.5,n="This means your sequence was not wrong (therefore was still correct) but there were better options out there. I recommend you try this practice assignment again. Still worth some marks though (half a mark)."));let s=0,o="Your PAM sequence was wrong and not found relative to your gRNA sequence. Either you made a typo or this answer was not correct. Either it contained the cut site within the PAM site or it was not an NGG or NAG PAM site (SciGrade only accepts either of those two PAM sites).";MARPAMseq&&(s=2,o="This means your answer was correct and you received full marks.");let a=0,r="Your off-target score was wrong. Either it was not above/within the optimal range (or above 35) or the last-resort option.";MAROffTarget&&(1===MAROffTarget_degree?(a=2,r="This means your answer was correct while above/within the optimal and you received full marks."):2===MAROffTarget_degree?(a=1,r="This means your answer was technically correct as its on-target value was above 35."):3===MAROffTarget_degree&&(a=.5,r="This means your answer was partially correct as it was found to be your only option is solely based on the target region range you selected."));let l=0,i="";for(let g=0;g<possible_F1_primers.length;g+=1)i+=possible_F1_primers[g],g===possible_F1_primers.length-1?i+=".":i+=", ";let d=`Your F1 primer sequence was incorrectly matched to one of the following sequences generated based on your gRNA sequence inputted: ${i}`;MARF1primers&&(l=2,d="This means your answer was correct and you received full marks.");let u=0,c="";for(let g=0;g<possible_R1_primers.length;g+=1)c+=possible_F1_primers[g],g===possible_R1_primers.length-1?c+=".":c+=", ";let m=`Your R1 primer sequence was incorrectly matched to one of the following sequences generated based on your gRNA sequence inputted: ${c}`;MARR1primers&&(u=2,m="This means your answer was correct and you received full marks."),t+="<div class='card about'>",t+="<div class='card-header' id='gRNACard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#gRNAOutput' aria-expanded='false' aria-controls='gRNAOutput'>",t+=`gRNA Strand Sequence: ${e}/2`,t+="</button>",t+="</h5>",t+="</div>",t+="<div id='gRNAOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+=`<p> For gRNA Strand Sequence, you put down "${all_answers[0]}" which gave you the mark ${e}.</p>`,t+=n,t+="</div>",t+="</div>",t+="</div>",$("#mainContainer").append(t),t="<div class='card about'>",t+="<div class='card-header' id='PAMCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#PAMOutput' aria-expanded='false' aria-controls='PAMOutput'>",t+=`gRNA PAM Sequence: ${s}/2`,t+="</button>",t+="</h5>",t+="</div>",t+="<div id='PAMOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+=`<p> For gRNA PAM Sequence, you put down "${all_answers[1]}" which gave you the mark ${s}.</p>`,t+=o,t+="</div>",t+="</div>",t+="</div>",$("#mainContainer").append(t),t="<div class='card about'>",t+="<div class='card-header' id='OffTargetCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#OffTargetOutput' aria-expanded='false' aria-controls='OffTargetOutput'>",t+=`Off-target Score: ${a}/2`,t+="</button>",t+="</h5>",t+="</div>",t+="<div id='OffTargetOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+=`<p> For Off-Target Score, you put down "${all_answers[4]}" which gave you the mark ${a}.</p>`,t+=r,t+="</div>",t+="</div>",t+="</div>",$("#mainContainer").append(t),t="<div class='card about'>",t+="<div class='card-header' id='F1PrimerCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#F1PrimerOutput' aria-expanded='false' aria-controls='F1PrimerOutput'>",t+=`F1 Primer: ${l}/2`,t+="</button>",t+="</h5>",t+="</div>",t+="<div id='F1PrimerOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+=`<p> For F1 Primer, you put down "${all_answers[5]}" which gave you the mark ${l}.</p>`,t+=d,t+="</div>",t+="</div>",t+="</div>",$("#mainContainer").append(t),t="<div class='card about'>",t+="<div class='card-header' id='R1PrimerCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#R1PrimerOutput' aria-expanded='false' aria-controls='R1PrimerOutput'>",t+=`R1 Primer: ${u}/2`,t+="</button>",t+="</h5>",t+="</div>",t+="<div id='R1PrimerOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+=`<p> For R1 Primer, you put down "${all_answers[6]}" which gave you the mark ${u}.</p>`,t+=m,t+="</div>",t+="</div>",t+="</div>",$("#mainContainer").append(t),t="<br>",t+="<p> If at any point you wish to dispute marks, please contact your TA or professor once you completed your assignment. If you have found a bug in our SciGrade marking system, please contact your professor or our admin. </p>",t+="<br>",t+='<p> <button type="button" class="btn btn-primary" onclick="backToAssignments();"> Back to Assignments </button> </p>',$("#mainContainer").append(t)}function showNewInput(t,e,n){document.getElementById(String(t)).value===String(e)?document.getElementById(String(n)).removeAttribute("hidden"):document.getElementById(String(n)).setAttribute("hidden",!0)}let completed_assignments=[];function generateCompletedAssignmentList(){completed_assignments=[],loadJSON_Files(),student_reg_information[0].student_list[studentParseNum]["assignment-HBB-Marks"]&&(completed_assignments.includes("HBB")||completed_assignments.push("HBB")),student_reg_information[0].student_list[studentParseNum]["assignment-CCR5-Marks"]&&(completed_assignments.includes("CCR5")||completed_assignments.push("CCR5")),student_reg_information[0].student_list[studentParseNum]["assignment-ANKK1-Marks"]&&(completed_assignments.includes("ANKK1")||completed_assignments.push("ANKK1")),student_reg_information[0].student_list[studentParseNum]["assignment-APOE-Marks"]&&(completed_assignments.includes("APOE")||completed_assignments.push("APOE"))}function openAccountManagement(){generateCompletedAssignmentList(),$("#accountManagementBody").empty();let t=`\n\t\t<div id='accordion'>\n\t\t\t<p>\n\t\t\t\tHello ${student_reg_information[0].student_list[studentParseNum].name.split(" ")[0]}!\n\t\t\t</p>\n\t\t</div>\n\t\t`;$("#accountManagementBody").append(t),t=`\n\t\t<div class='card about'>\n\t\t\t<div class='card-header' id='assignmentCard'>\n\t\t\t\t<h5 class='mb-0'>\n\t\t\t\t\t<button class='btn btn-link' data-toggle='collapse' data-target='#completedAssignments' aria-expanded='true' aria-controls='completedAssignments'>\n\t\t\t\t\t\tCompleted assignments:\n\t\t\t\t\t</button>\n\t\t\t\t</h5>\n\t\t\t</div>\n\n\t\t\t<div id='completedAssignments' class='collapse show' aria-labelledby='headingOne' data-parent='#accordion'>\n\t\t\t\t<div class='card-body'>\n\t\t\t\t\t${completed_assignments.length>0?`\n\t\t\t\t\t\t\t<p>You have completed the following assignments: <p>\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t${completed_assignments.map((t=>`<li>${t}</li>`)).join("")}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t`:"\n\t\t\t\t\t\t\t<p> You have not completed any assignments yet. </p>\n\t\t\t\t\t\t\t"}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,$("#accountManagementBody").append(t);const e=student_reg_information[0].class_list;if(["admin","TA"].includes(student_reg_information[0].student_list[studentParseNum].type)){t=`<br>\n\t\t\t<p>\n\t\t\t\t<b> Oh wait! </b> Hello ${student_reg_information[0].student_list[studentParseNum].type}! Would you like to download student marks?\n\t\t\t</p>`,t+='<label for="DownloadClass">Choose class: </label>',t+='<select id="DownloadClass" class="form-control" style="margin-bottom: 1%">';for(const n in e)n&&(t+=`<option value="${n}" id="${n}" tag="assignment">${n}</option>\n`);t+="</select>",t+='<p style="text-align: center;"> <button type="button" class="btn btn-primary" onclick="generateHiddenStudentDownload(document.getElementById(\'DownloadClass\').value, true);"> Download Marks </button>',t+='<button type="button" class="btn btn-primary" onclick="generateHiddenStudentDownload(document.getElementById(\'DownloadClass\').value, false);" style="margin-left: 2%;"> Download Raw Marks </button> </p>',$("#accountManagementBody").append(t)}if("TA"===student_reg_information[0].student_list[studentParseNum].type||"admin"===student_reg_information[0].student_list[studentParseNum].type){loadJSON_Files(),t="<p> <b> ADMIN POWER! </b> <p>",t+="<div class='card about'>",t+="<div class='card-header' id='studentCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#addStudents' aria-expanded='false' aria-controls='addStudents' onclick='showNewInput(\"InputClassMultiple\", \"newClass\", \"InputNewClassMultiple\")'>",t+="Create new class: ",t+="</button>",t+="</h5>",t+="</div>",t+="<div id='addStudents' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+="<p style='font-weight: bold;'> If you would like to create a  new class, just fill the form below: ",t+="<form>",t+='<div class="form-group">',t+='<label for="InputClassMultiple" style="font-weight: bold;">Create class name: </label>',t+='<select id="InputClassMultiple" class="form-control" style="margin-bottom: 1%" disabled>',t+='<option value="newClass" id="newClassMultiple" tag="assignment" >New Class</option>\n',t+="</select>",t+='<input class="form-control" id="InputNewClassMultiple" placeholder="HMB396 - Winter (NOTE: Spaces will be deleted once you submit so use capital letters to separate words)" hidden>',t+='<small id="InputClassHelp" class="form-text text-muted">Choose class students will be added to or create a new class. Example of a new class: HMB396 - Winter - 2019 (NOTE: Spaces will be deleted once you submit so use capital letters to separate words)</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="InputStudentNumber" style="font-weight: bold;">Input student numbers: </label>',t+='<textarea class="form-control" id="StudentNumbers" rows="4" placeholder="1234567890, 1003817535, 1113315545"></textarea>',t+='<small id="InputStudentNumberHelp" class="form-text text-muted">Input student numbers, separated by commas, new lines and/or tab indentation (BEWARE OF TYPOS!)</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="InputStudentUmail" style="font-weight: bold;">Input student University email: </label>',t+='<textarea class="form-control" id="StudentUmails" rows="4" placeholder="john.doe@mail.utoronto.ca, sarah.cat@.mail.utoronto.ca, alexander.macadonia@utoronto.ca"></textarea>',t+='<small id="InputStudentUmailUmail" class="form-text text-muted">Input student University associated email in the same order of the student numbers, separated by commas, new lines and/or tab indentation (BEWARE OF TYPOS!)</small>',t+="</div>",t+="<p> <button type=\"button\" class=\"btn btn-primary\" onclick=\"changeInputClass('InputClassMultiple', 'newClass', 'newClassMultiple', document.getElementById('InputNewClassMultiple').value), addMultipleUsersToServer(document.getElementById('InputClassMultiple').value, document.getElementById('StudentNumbers'), document.getElementById('StudentUmails'));\"> Send multiple students to Server </button>",t+="<br>",t+="</form>",t+="</div>",t+="</div>",t+="</div>",$("#accountManagementBody").append(t),t="<div class='card about'>",t+="<div class='card-header' id='addTACard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#addTA' aria-expanded='true' aria-controls='addTA'>",t+="Add single user: ",t+="</button>",t+="</h5>",t+="</div>",t+="<div id='addTA' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+="<p style='font-weight: bold;'>If you would like to add a single user (students, TAs or admins), please fill in the form below. Please note, this will default the user as a student. Only admins will be able to create new TAs or admins</p>",t+="<form>",t+='<div class="form-group">',t+='<label for="InputClassSingle" style="font-weight: bold;">Choose class: </label>',t+='<select id="InputClassSingle" class="form-control" style="margin-bottom: 1%;">';for(const n in e)n&&(t+=`<option value="${n}" id="${n}" tag="assignment">${n}</option>\n`);t+="</select>",t+='<small id="InputClassSingleHelp" class="form-text text-muted">Choose class TA will be added.</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="InputStudentNumber" style="font-weight: bold;">User\'s number</label>',t+='<input class="form-control" id="StudentNumber" placeholder="1234567890" maxlength="10">',t+='<small id="InputStudentNumberHelp" class="form-text text-muted">The user\'s access number (like a student or employee number)</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="InputStudentUmail" style="font-weight: bold;">User\'s umail</label>',t+='<input type="email" class="form-control" id="StudentUmail" placeholder="first.last@mail.utoronto.ca">',t+='<small id="InputStudentNumberHelp" class="form-text text-muted">The user\'s University associated email</small>',t+="</div>",t+="<p> <button type=\"button\" class=\"btn btn-primary\" onclick=\"addUserToServer(document.getElementById('InputClassSingle').value, document.getElementById('StudentNumber').value.trim(), document.getElementById('StudentUmail').value.trim());\"> Send single user to Server </button>",t+="<br>",t+="</form>",t+="</div>",t+="</div>",t+="</div>",$("#accountManagementBody").append(t)}if("admin"===student_reg_information[0].student_list[studentParseNum].type){t="<div class='card about'>",t+="<div class='card-header' id='modifyCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#modifyControls' aria-expanded='true' aria-controls='modifyControls' onclick='ChangeDOMInnerhtml(\"CurrentOffTarget\", \"Current off-target marking is set to: \" + student_reg_information[0][\"classMarkingMod\"][document.getElementById(\"ClassModChange\").value][0])'>",t+="Modify marking controls: ",t+="</button>",t+="</h5>",t+="</div>",t+="<div id='modifyControls' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+="<p style='font-weight: bold;'>If you would like to change a class's off-target optimal goal, you can do that here</p>",t+='<div class="form-group">',t+='<label for="ClassModChange" style="font-weight: bold;">Choose class: </label>',t+="<select id=\"ClassModChange\" class=\"form-control\" style=\"margin-bottom: 1%;\" onchange=\"ChangeDOMInnerhtml('CurrentOffTarget', 'Current off-target marking is set to: ' + student_reg_information[0]['classMarkingMod'][document.getElementById('ClassModChange').value][0])\">";for(const n in e)n&&(t+=`<option value="${n}" id="${n}" tag="assignment">${n}</option>\n`);t+="</select>",t+='<small id="ClassModChangeHelp" class="form-text text-muted">Choose the class for which you are modifying marking scheme for.</small>',t+="</div>",t+='<div class="form-group">',t+='<p style="font-weight: bold;">Modify controls for: </p>',t+='<label for="SelectModifyControls">Off-Target Marking: </label>',t+='<p id="CurrentOffTarget">Current off-target marking is set to: </p>',t+='<select id="SelectModifyControls" class="form-control" onchange="showNewInput(\'SelectModifyControls\', \'Custom\', \'InputModifyControls\')" style="margin-bottom: 1%">',t+='<option value="Optimal" id="Optimal" tag="assignment">Optimal</option>\n',t+='<option value="Custom" id="CustomOffTarget" tag="assignment">Custom</option>\n',t+="</select>",t+='<input class="form-control" id="InputModifyControls" type="number" step="0.01" min="0.01" max="100" placeholder="Insert number between 0.01 and 100" hidden>',t+='<small id="InputModifyControlsHelp" class="form-text text-muted">Choose how you want the off-target score to be marked. Optimal is Min_optimal = Max_range - (Max_range * 0.2) if below 80 (if below, optimal = 80). Custom value can be any number between 0.01 and 100 which will be the new custom "optimal" value for your class.</small>',t+="</div>",t+="<p> <button type=\"button\" class=\"btn btn-primary\" onclick=\"changeInputClass('SelectModifyControls', 'Custom', 'CustomOffTarget', document.getElementById('InputModifyControls').value), UpdateMarkingControls(document.getElementById('ClassModChange').value, document.getElementById('SelectModifyControls').value)\"> Update Marking Scheme </button>",t+="<br>",t+="</div>",t+="</div>",t+="</div>",$("#accountManagementBody").append(t),t="<div class='card about'>",t+="<div class='card-header' id='typeCard'>",t+="<h5 class='mb-0'>",t+="<button class='btn btn-link' data-toggle='collapse' data-target='#typeControl' aria-expanded='true' aria-controls='typeControl' onclick=\"UpdateStudentList(document.getElementById('ClassChange').value); UpdateChooseUser('ClassUserChange');\">",t+="Change a user's account type: ",t+="</button>",t+="</h5>",t+="</div>",t+="<div id='typeControl' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",t+="<div class='card-body'>",t+="<p style='font-weight: bold;'>If you would like to change a user's account type (to TA or admin or back to student), you can do that below</p>",t+='<div class="form-group">',t+='<label for="ClassChange" style="font-weight: bold;">Choose class: </label>',t+='<select id="ClassChange" class="form-control" style="margin-bottom: 1%;" onchange="UpdateStudentList(document.getElementById(\'ClassChange\').value); UpdateChooseUser(\'ClassUserChange\');">';for(const n in e)n&&(t+=`<option value="${n}" id="${n}" tag="assignment">${n}</option>\n`);t+="</select>",t+='<small id="ClassChangeHelp" class="form-text text-muted">Choose the class for which the user belongs to.</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="ClassUserChange" style="font-weight: bold;">Choose user: </label>',t+='<select id="ClassUserChange" class="form-control" style="margin-bottom: 1%;" onchange="">',t+="</select>",t+='<small id="ClassUserChangeHelp" class="form-text text-muted">Choose the user for which you change their account type for.</small>',t+="</div>",t+='<div class="form-group">',t+='<label for="ClassTypeChange" style="font-weight: bold;">Choose type: </label>',t+='<select id="ClassTypeChange" class="form-control" style="margin-bottom: 1%;" onchange="">',t+='<option value="Student" id="Student" tag="userType">Student</option>\n',t+='<option value="TA" id="TA" tag="userType">TA</option>\n',t+='<option value="admin" id="admin" tag="userType">admin</option>\n',t+="</select>",t+='<small id="ClassTypeChangeHelp" class="form-text text-muted">Choose the type for which you want the user to become.</small>',t+="</div>",t+="<p> <button type=\"button\" class=\"btn btn-primary\" onclick=\"UpdateUserType(document.getElementById('ClassChange').value, document.getElementById('ClassUserChange').value, document.getElementById('ClassTypeChange').value);\"> Update User's Type </button>",t+="<br>",t+="</div>",t+="</div>",t+="</div>",$("#accountManagementBody").append(t)}t="</div>",$("#accountManagementBody").append(t),$("#accountModal").modal("show")}function UpdateChooseUser(t){ClearSelectOptions(t);for(const e in updatedListOfStudents)updatedListOfStudents[e]&&AddToOptions(t,e,updatedListOfStudents[e])}function AddToOptions(t,e,n){const s=document.getElementById(t),o=document.createElement("option");o.value=e,o.innerHTML=n,s.appendChild(o)}function ClearSelectOptions(t){const e=document.getElementById(t);for(;e.options.length>0;)e.options.remove(0)}let updatedListOfStudents={};function UpdateStudentList(t){updatedListOfStudents={};const e=student_reg_information[0].student_list;for(const n of e)n.studentClass===t&&(updatedListOfStudents[n.name]=`${n.name} - ${n.type}`)}function UpdateUserType(t,e,n){const s=student_reg_information[0].student_list;for(let o=0;o<s.length;o+=1)if(s[o].studentClass===t&&s[o].name===e){const t=`student_list.${o}.type`;client.login().then((()=>db.collection("Student_Information").updateOne({version:"0.3"},{$set:{[t]:n}},((t,e)=>{if(t)throw t;db.close()})))),$("#adminSendButton").click()}}function UpdateMarkingControls(t,e){const n=`classMarkingMod.${t}`,s=[e];client.login().then((()=>db.collection("Student_Information").updateOne({version:"0.3"},{$set:{[n]:s}},((t,e)=>{if(t)throw t;db.close()})))),$("#adminSendButton").click(),document.getElementById("InputModifyControls").value="",document.getElementById("CustomOffTarget").value="Custom"}function ChangeDOMInnerhtml(t,e){document.getElementById(t).innerHTML=e}const downloadIndexTable_start="\t\t<tr>\n\t\t\t<th>Student Number</th>\n\t\t\t<th>Name</th>",downloadIndexTable_end="\n\t\t</tr>\n";let downloadIndexTable_fill="";function generateRestOfIndexTable(t,e){t=downloadIndexTable_start;for(const n of list_of_assignments)t+=`\n\t\t\t<th>${n}</th>`,e?(t+="\n\t\t\t<th>Percent</th>",t+="\n\t\t\t<th>Raw</th>"):e||(t+="\n\t\t\t<th>Percent</th>",t+="\n\t\t\t<th>Raw</th>",t+="\n\t\t\t<th>gRNA</th>",t+="\n\t\t\t<th>Mark</th>",t+="\n\t\t\t<th>PAM</th>",t+="\n\t\t\t<th>Mark</th>",t+="\n\t\t\t<th>Off-target score</th>",t+="\n\t\t\t<th>Mark</th>",t+="\n\t\t\t<th>F1 primers</th>",t+="\n\t\t\t<th>Mark</th>",t+="\n\t\t\t<th>R1 primers</th>",t+="\n\t\t\t<th>Mark</th>");return t+="\n\t\t</tr>\n"}function generateHiddenStudentDownload(t,e){if("TA"===student_reg_information[0].student_list[studentParseNum].type||"admin"===student_reg_information[0].student_list[studentParseNum].type){downloadIndexTable_fill=generateRestOfIndexTable(downloadIndexTable_fill,e),$("#hiddenDownloadModal_table").empty();const n=new Date;let s="<table id='downloadIndexTable'>\n\t<tbody>\n",o="SciGrade_studentMark_";e||(o="SciGrade_studentMarkRaw_"),s+=`\t\t<caption>${o}${student_reg_information[0].student_list[studentParseNum].name.replace(/\s/g,"")}_${n.getFullYear()}-${n.getMonth()}_${n.getDate()}</caption>\n`,s+=downloadIndexTable_fill;const a=student_reg_information[0].student_list;for(const r of a)if("Student"===r.type&&r.studentClass===t){if(s+="\t\t<tr>\n",s+=`\t\t\t<td>${r.student_number}</td>\n`,s+=`\t\t\t<td>${r.name}</td>\n`,e)for(const t of list_of_assignments){const e=`assignment-${t}-Marks`;r[e]?(s+=`\t\t\t<td>${t.toString()}</td>\n`,s+=`\t\t\t<td>${r[e][1].toString()}</td>\n`,s+=`\t\t\t<td>${r[e][0].toString()}</td>\n`):null===r[e]&&(s+=`\t\t\t<td>${t.toString()}</td>\n`,s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n")}if(!e)for(const t of list_of_assignments){const e=`assignment-${t}-Marks`;if(r[e]){s+=`\t\t\t<td>${t.toString()}</td>\n`;let n=0;s+=`\t\t\t<td>${r[e][1].toString()}</td>\n`,s+=`\t\t\t<td>${r[e][0].toString()}</td>\n`,s+=`\t\t\t\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t${r[`assignment-${t}-Answers`][0].toString()}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t`,1===r[`assignment-${t}-Outputs`][2]?n=2:2===r[`assignment-${t}-Outputs`][2]?n=1:3===r[`assignment-${t}-Outputs`][2]&&(n=.5),s+=`\t\t\t<td>${n.toString()}</td>\n`,s+=`\t\t\t\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t${r[`assignment-${t}-Answers`][1].toString()}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t`,n=r[`assignment-${t}-Outputs`][4]?2:0,s+=`\t\t\t<td>${n.toString()}</td>\n`,s+=`\t\t\t\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t${r[`assignment-${t}-Answers`][4].toString()}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t`,1===r[`assignment-${t}-Outputs`][6]?n=2:2===r[`assignment-${t}-Outputs`][6]?n=1:3===r[`assignment-${t}-Outputs`][6]&&(n=.5),s+=`\t\t\t<td>${n.toString()}</td>\n`,s+=`\t\t\t\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t${r[`assignment-${t}-Answers`][5].toString()}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t`,n=r[`assignment-${t}-Outputs`][10]?2:0,s+=`\t\t\t<td>${n.toString()}</td>\n`,s+=`\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t${r[`assignment-${t}-Answers`][6].toString()}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t`,n=r[`assignment-${t}-Outputs`][11]?2:0,s+=`\t\t\t<td>${n.toString()}</td>\n`}else r[e]||(s+=`\t\t\t<td>${t.toString()}</td>\n`,s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n",s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n",s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n",s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n",s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n",s+="\t\t\t<td> Incompleted </td>\n",s+="\t\t\t<td> 0.00 </td>\n")}s+="\t\t</tr>\n"}s+="\t</tbody>\n</table>",document.getElementById("hiddenDownloadModal_table").innerHTML+=s,$("#hiddenDownloadModal_table").tableToCSV()}else showRegError(7)}function changeInputClass(t,e,n,s){""!==s&&void 0!==s||(s="undefined Class"),s=s.replace(/\s/g,""),document.getElementById(t).value===e&&(document.getElementById(n).value=s)}function addUserToServer(t,e,n){const s=n,o={};o[e]=s,classList=`class_list.${t}`,classExists=!1,student_reg_information[0].class_list[t]&&(classExists=!0);for(const a in o)if(o[a]){const e=`class_list.${t}.${a}`;client.login().then((()=>db.collection("Student_Information").updateOne({version:"0.3"},{$set:{[e]:o[a]}},((t,e)=>{if(t)throw t;db.close()}))))}$("#adminSendButton").click(),document.getElementById("StudentNumber").value="",document.getElementById("StudentUmail").value=""}let classExists=!1;function addMultipleUsersToServer(t,e,n){const s=e.value.trim().split(/,|\n|\t/);""===s[s.length-1].trim()&&s.pop();const o=n.value.trim().split(/,|\n|\t/);if(""===o[o.length-1].trim()&&o.pop(),s.length===o.length){const e={};for(let t=0;t<s.length;t+=1){const n=s[t],a=o[t];e[n]=a}const n=`class_list.${t}`;if(classExists=!1,student_reg_information[0].class_list[t]&&(classExists=!0),!classExists){client.login().then((()=>db.collection("Student_Information").updateOne({version:"0.3"},{$set:{[n]:e}},((t,e)=>{if(t)throw t;db.close()})))),$("#adminSendButton").click();const s=`classMarkingMod.${t}`,o=["Optimal"];client.login().then((()=>db.collection("Student_Information").updateOne({version:"0.3"},{$set:{[s]:o}},((t,e)=>{if(t)throw t;db.close()})))),$("#adminSendButton").click()}document.getElementById("StudentNumbers").value="",document.getElementById("StudentUmails").value=""}else showRegError(8)}function removeCompletedAssignments(){generateCompletedAssignmentList();let t=[];if(completed_assignments.length>0)for(const e of list_of_assignments)completed_assignments.includes(e)||t.push(e);else 0===completed_assignments.length&&(t=list_of_assignments);return t}let all_answers=[],all_outputs=[],all_marks=[],studentAnswers=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Answers`,studentOutputs=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Outputs`,studentMarks=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Marks`;function submitAnswers(){all_answers=[],all_outputs=[],all_marks=[],checkAnswers(),setTimeout((()=>{markAnswers(),studentAnswers=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Answers`,studentOutputs=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Outputs`,studentMarks=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Marks`,all_answers.push(document.getElementById("sequence_input").value.trim(),document.getElementById("pam_input").value.trim(),document.getElementById("position_input").value,document.getElementById("strand_input").value,document.getElementById("offtarget_input").value,document.getElementById("f1_input").value.trim(),document.getElementById("r1_input").value.trim()),all_outputs.push(MARstrand,MARgRNAseq,MARgRNAseq_degree,MARCutPos,MARPAMseq,MAROffTarget,MAROffTarget_degree,MAROffTarget_aboveOpt,MAROffTarget_above35,MAROffTarget_onlyOption,MARF1primers,MARR1primers),all_marks.push(studentMark,studentMarkPercentage),continueWithoutLogin||client.login().then((()=>db.collection("Student_Information").updateOne({version:"0.3"},{$set:{[studentAnswers]:all_answers,[studentOutputs]:all_outputs,[studentMarks]:all_marks}},((t,e)=>{if(t)throw t;db.close()})))),loadJSON_Files(),"assignment"===loadedMode?(document.getElementById("options_label").innerHTML="Would you like to start a new assignment?",document.getElementById("seeFeedback").setAttribute("hidden",!0)):"practice"===loadedMode&&(document.getElementById("options_label").innerHTML="Would you like to see feedback on your answers or start a new assignment?",document.getElementById("seeFeedback").removeAttribute("hidden"),showFeedback()),$("#feedbackButton").click()}),750)}function IfPressEnter(t,e){13!==t.which&&13!==t.keyCode||$(`#${e}`).click()}function backToAssignments(){redirectCRISPR(),loadJSON_Files(),$("#practice").click()}$((()=>{$("form").submit((()=>!1))}));