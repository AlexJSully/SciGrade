let selection_inMode="practice";const listOfGenes=["eBFP","ACTN3","HBB","CCR5","ANKK1","APOE"];let gene_backgroundInfo,benchling_grna_outputs,possible_gene="eBFP",current_gene="empty";function select_Gene(){""!==possible_gene||possible_gene?(current_gene=possible_gene,loadWork(),checkAnswers_executed=!1):("empty"===current_gene&&"eBFP"===current_gene&&"ACTN3"===current_gene&&"HBB"===current_gene&&"CCR5"===current_gene&&"ANKK1"===current_gene&&"APOE"===current_gene||(current_gene="empty"),alert("Error code sG34-42 occurred. Please contact admin or TA!"))}async function loadCRISPRJSON_Files(){try{const responseBenchling=await fetch("./data/Benchling_gRNA_Outputs.json");benchling_grna_outputs=await responseBenchling.json();const responseGeneBackground=await fetch("data/Background_info/gene_background_info.json");gene_backgroundInfo=await responseGeneBackground.json()}catch(err){console.error("Error fetching file:",err)}}function fillGeneList(){if(gene_backgroundInfo?.gene_list){let append_str;$("#gene_dropdown_selection").empty();const listOfGenes=Object.keys(gene_backgroundInfo.gene_list);for(const gene of listOfGenes)append_str+=`\n\t\t\t\t<option value="${gene}" id="${gene}" tag="practice">${gene}</option>\n\t\t\t`;$("#gene_dropdown_selection").append(append_str)}}let loadedMode="practice";function loadWork(){if(gene_backgroundInfo||""!==gene_backgroundInfo||backgroundInfo?.[0].gene_list[current_gene]){let append_str;$("#work").empty(),loadedMode=selection_inMode,checkAnswers_executed=!1,append_str='<div class="work_background" style="margin-top:2%;">',append_str+='<div id="crispr_header">\n<p>Please refer to your dry lab protocol for full instructions on how and what to do. Below is a brief reminder of what you are supposed to do with each gene: \n <b>Your objective is to find these mutations, design a gRNA and its corresponding F1/R1 primers</b></p> \n</div>\n',append_str+=`<div id="gene_info"><p>Here is some background information about your gene: ${gene_backgroundInfo?.gene_list[current_gene].name} (${current_gene})</p>\n`,append_str+=`<p> Background information: ${gene_backgroundInfo?.gene_list[current_gene].Background}</p>\n`,append_str+=`<p> Target site: ${gene_backgroundInfo?.gene_list[current_gene]["Target site"]}</p>\n`,append_str+=`<p style="word-wrap:break-word;"> Modified genetic sequence: ${gene_backgroundInfo?.gene_list[current_gene].Sequence}</p>\n`,append_str+="</div>",append_str+="</div>",append_str+='<div id="work_section">',append_str+="<p> Please input the following information for your gRNA for your selected gene.</p>\n",append_str+="<form>",append_str+='<div class="form-group">',append_str+='<label for="sequence_input">gRNA Sequence:</label>',append_str+='<input class="form-control" id="sequence_input" placeholder="CTCGTGACCACCCTGACCCA" maxlength="20" required>',append_str+='<small id="sequence_inputSmall" class="form-text text-muted">This would be your gRNA sequence 5\' to 3\'. NOTE: This is maxed out at 20 characters long</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="pam_input">PAM Sequence:</label>',append_str+='<input class="form-control" id="pam_input" placeholder="CGG" maxlength="3" required>',append_str+='<small id="pam_inputSmall" class="form-text text-muted">This would be your PAM sequence 5\' to 3\'. NOTE: This is maxed out at 3 characters long</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="position_input">Cut position:</label>',append_str+='<input class="form-control" id="position_input" placeholder="380" type="number" required>',append_str+='<small id="position_inputSmall" class="form-text text-muted">This would be your cut position for your gRNA. NOTE: This input only takes numbers</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="strand_input">gRNA Strand:</label>',append_str+='<select class="form-control" id="strand_input" style="border: 1px solid #28a745;" required><option>Antisense (-)</option><option>Sense (+)</option></select>',append_str+='<small id="strand_inputSmall" class="form-text text-muted">This would be for which strand your gRNA is on.</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="offtarget_input">Off-target score:</label>',append_str+='<input class="form-control" id="offtarget_input" placeholder="60.7" step="0.01" type="number" required>',append_str+='<small id="position_inputSmall" class="form-text text-muted">This would be your off-target score for your gRNA. NOTE: This input only takes numbers</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="f1_input">F1 Primers:</label>',append_str+='<input class="form-control" id="f1_input" placeholder="TAATACGACTCACTATAGCTCGTGACCACCCTGA" required>',append_str+='<small id="f1_inputSmall" class="form-text text-muted">This would be your forward primer (F1) for your gRNA</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="r1_input">R1 Primers:</label>',append_str+='<input class="form-control" id="r1_input" placeholder="TTCTAGCTCTAAAACTGGGTCAGGGTGGTCACGAG" required>',append_str+='<small id="r1_inputSmall" class="form-text text-muted">This would be your reverse primer (R1) for your gRNA</small>',append_str+="</div>",append_str+='<button type="button" class="btn btn-success" style="margin:1%;" hidden>Save</button>',append_str+='<button id="assignmentSubmitButton" type="button" class="btn btn-primary" style="margin:1%;" onclick="submitAnswers();">Submit</button>',append_str+="</form>",append_str+="</div>",$("#work").append(append_str)}else""!==gene_backgroundInfo&&gene_backgroundInfo&&backgroundInfo?.[0].gene_list[current_gene]||alert("Error code lFS50-66 occurred. Please contact admin or TA!")}function isNumberOrDashKey(evt){const charCode=evt.which?evt.which:evt.keyCode;return!(46!==charCode&&45!==charCode&&charCode>31&&(charCode<48||charCode>57))}let MARgRNAseq=!1,MARgRNAseq_degree=0,MARPAMseq=!1,MARCutPos=!1,MARstrand=!1,MAROffTarget=!1,MAROffTarget_degree=0,MAROffTarget_aboveOpt=!1,MAROffTarget_above35=!1,MAROffTarget_onlyOption=!1,MARF1primers=!1,MARR1primers=!1,possible_comparable_answers=[],correctNucleotideIncluded=!1,true_counts=0,checkAnswers_executed=!1;function checkAnswers(){MARgRNAseq=!1,MARgRNAseq_degree=0,MARPAMseq=!1,MARCutPos=!1,MARstrand=!1,correctNucleotideIncluded=!1,true_counts=0;const correctNucleotidePosition=gene_backgroundInfo.gene_list[current_gene]["Target position"]-1,inputtedSeq=document?.getElementById("sequence_input")?.value?.trim()||void 0;if(possible_comparable_answers=[],inputtedSeq)for(const answer of benchling_grna_outputs.gene_list[current_gene])answer.Sequence===inputtedSeq&&possible_comparable_answers.push(answer);if(possible_comparable_answers.length>0)for(const possibleAnswer of possible_comparable_answers){if(true_counts=0,correctNucleotideIncluded=!1,1===possibleAnswer.Strand){const nucleotideIncludedRange_top=possibleAnswer.Position-1-1+3;correctNucleotidePosition>=possibleAnswer.Position-1-17&&correctNucleotidePosition<=nucleotideIncludedRange_top&&(correctNucleotideIncluded=!0)}else if(-1===possibleAnswer.Strand){const nucleotideIncludedRange_top=possibleAnswer.Position-1+17;correctNucleotidePosition>=possibleAnswer.Position-1-3&&correctNucleotidePosition<=nucleotideIncludedRange_top&&(correctNucleotideIncluded=!0)}if(correctNucleotideIncluded){let pamFirst,pamSecond;if(1===possibleAnswer.Strand?(pamFirst=possibleAnswer.Position-1+2,pamSecond=possibleAnswer.Position-1+4,"Sense (+)"===document.getElementById("strand_input").value&&(MARstrand=!0,true_counts+=1)):-1===possibleAnswer.Strand&&(pamFirst=possibleAnswer.Position-1-2,pamSecond=possibleAnswer.Position-1-4,"Antisense (-)"===document.getElementById("strand_input").value&&(MARstrand=!0,true_counts+=1)),correctNucleotidePosition>=pamFirst&&correctNucleotidePosition<=pamSecond?(MARgRNAseq=!1,MARgRNAseq_degree=0):correctNucleotidePosition>=possible_comparable_answers[i].Position-1+1&&correctNucleotidePosition<=possible_comparable_answers[i].Position-1+10||correctNucleotidePosition<=possible_comparable_answers[i].Position-1-1&&correctNucleotidePosition>=possible_comparable_answers[i].Position-1-10?(MARgRNAseq=!0,MARgRNAseq_degree=1,true_counts+=1):correctNucleotidePosition>=possible_comparable_answers[i].Position-1&&correctNucleotidePosition<=possible_comparable_answers[i].Position-1+20||correctNucleotidePosition<=possible_comparable_answers[i].Position-1&&correctNucleotidePosition>=possible_comparable_answers[i].Position-1-20?(MARgRNAseq=!0,MARgRNAseq_degree=2,true_counts+=1):(correctNucleotidePosition>=possible_comparable_answers[i].Position-1&&correctNucleotidePosition<=possible_comparable_answers[i].Position-1+30||correctNucleotidePosition<=possible_comparable_answers[i].Position-1&&correctNucleotidePosition>=possible_comparable_answers[i].Position-1-30)&&(MARgRNAseq=!0,MARgRNAseq_degree=3,true_counts+=1),MARgRNAseq){const temp_answer=element;temp_answer.Position&&parseInt(temp_answer.Position,10)===parseInt(document.getElementById("position_input").value,10)?(MARCutPos=!0,true_counts+=1):null!==temp_answer.Position&&void 0!==temp_answer.Position||alert("Error code cA302-307: retrieving server information on 'Position' answers occurred. Please contact admin or TA!"),(temp_answer.PAM||temp_answer.PAM)&&temp_answer.PAM===document.getElementById("pam_input").value.trim()?(MARPAMseq=!0,true_counts+=1):null!==temp_answer.PAM&&void 0!==temp_answer.PAM||alert("Error code cA311-317: retrieving server information on 'PAM' answers occurred. Please contact admin or TA!"),temp_answer["Specificity Score"]||temp_answer["Specificity Score"]?checkOffTarget(temp_answer["Specificity Score"]):null!==temp_answer["Specificity Score"]&&void 0!==temp_answer["Specificity Score"]||alert("Error code cA342-348: retrieving server information on 'Specificity Score' answers occurred. Please contact admin or TA!"),checkF1Primers(document?.getElementById("sequence_input")?.value?.trim()||""),checkR1Primers(document?.getElementById("sequence_input")?.value?.trim()||"")}}}checkAnswers_executed=!0}let offtarget_List=[],offtarget_dict={},offtarget_dictParse=[],offtarget_Use=[];function checkOffTarget(score){MAROffTarget=!1,MAROffTarget_degree=0,MAROffTarget_aboveOpt=!1,MAROffTarget_above35=!1,MAROffTarget_onlyOption=!1;const OffTargetValue_down=Math.floor(score),OffTargetValue_up=Math.ceil(score),InputOffTargetValue=parseInt(document.getElementById("offtarget_input").value,10);if(correctNucleotideIncluded&&MARgRNAseq&&InputOffTargetValue>=OffTargetValue_down&&InputOffTargetValue<=OffTargetValue_up&&(MAROffTarget=!0,true_counts+=1),MAROffTarget){const rangeStarter_upper=parseInt(document.getElementById("position_input").value,10)+35,rangeStarter_lower=parseInt(document.getElementById("position_input").value,10)-35;offtarget_List=[],offtarget_dict={},offtarget_dictParse=[],offtarget_Use=[];for(let i=0;i<benchling_grna_outputs.gene_list[current_gene].length;i+=1)benchling_grna_outputs.gene_list[current_gene][i].Position>=rangeStarter_lower&&benchling_grna_outputs.gene_list[current_gene][i].Position<=rangeStarter_upper&&benchling_grna_outputs.gene_list[current_gene][i]["Specificity Score"]&&(offtarget_List.push(benchling_grna_outputs.gene_list[current_gene][i]["Specificity Score"]),offtarget_dict[i]=benchling_grna_outputs.gene_list[current_gene][i]["Specificity Score"],offtarget_dictParse.push(i));let last_resort_okay=!0;Math.max.apply(null,offtarget_List)<35&&(last_resort_okay=!1);const Max_range=Math.max.apply(null,offtarget_List),Min_optimal=Max_range-.2*Max_range;let optimalValue=Min_optimal;const{studentClass:studentClass}=student_reg_information[0].student_list[studentParseNum];"Optimal"===student_reg_information[0].classMarkingMod[studentClass][0]?(Min_optimal>80||Min_optimal<35)&&(optimalValue=80):optimalValue=student_reg_information[0].classMarkingMod[studentClass][0],InputOffTargetValue>=optimalValue?(MAROffTarget_aboveOpt=!0,MAROffTarget_above35=!0,MAROffTarget_degree=1):InputOffTargetValue>=35?(MAROffTarget_above35=!0,MAROffTarget_degree=Math.max.apply(null,offtarget_List)<80?1:2):last_resort_okay||(MAROffTarget_onlyOption=!0,MAROffTarget_degree=3)}}let possible_F1_primers=[];function checkF1Primers(seq){MARF1primers=!1,possible_F1_primers=[];let count_First=!0;"G"===seq[0]&&(count_First=!1);for(let i=16;i<=20;i+=1)possible_F1_primers.push("TAATACGACTCACTATAG"+seq.slice(0,i));if(!count_First)for(let i=16;i<=20;i+=1)possible_F1_primers.push("TAATACGACTCACTATAG"+seq.slice(1,i));possible_F1_primers.includes(document.getElementById("f1_input").value.trim())&&(MARF1primers=!0)}let possible_R1_primers=[];const complementary_nt_dict={A:"T",T:"A",C:"G",G:"C"};function checkR1Primers(seq){MARR1primers=!1,possible_R1_primers=[];let complementary_seq="";for(const sequence of seq)complementary_seq=complementary_nt_dict[sequence]+complementary_seq;for(let i=19;i<=20;i+=1)possible_R1_primers.push("TTCTAGCTCTAAAAC"+complementary_seq.slice(0,i));possible_R1_primers.includes(document.getElementById("r1_input").value.trim())&&(MARR1primers=!0)}function createComplementarySeq(seq){let comp_seq="";for(const element of seq)comp_seq=complementary_nt_dict[element]+comp_seq}let studentMark=0,studentMarkPercentage=0;const markTotal=10;function markAnswers(){studentMark=0,checkAnswers_executed||checkAnswers(),checkAnswers_executed&&(MARgRNAseq&&(1===MARgRNAseq_degree?studentMark+=2:2===MARgRNAseq_degree?studentMark+=1:3===MARgRNAseq_degree&&(studentMark+=.5)),MARPAMseq&&(studentMark+=2),MAROffTarget&&(1===MAROffTarget_degree?studentMark+=2:2===MAROffTarget_degree?studentMark+=1:3===MAROffTarget_degree&&(studentMark+=.5)),MARF1primers&&(studentMark+=2),MARR1primers&&(studentMark+=2),studentMarkPercentage=(studentMark/markTotal*100).toFixed(2),studentMarkPercentage>100?studentMarkPercentage=100:studentMarkPercentage<0&&(studentMarkPercentage=0))}function showFeedback(){$("#mainContainer").empty();let append_str="<p style='font-weight:bold;'> You would only receive feedback on your practice attempts and not your final assignments.</p>";append_str+="<p> The assignment itself is marked out of 10 marks with 2 marks for each input excluding gRNA strand direction, cut position and target region range (these three values are used to calculate if you have the right answer or not which means they are still crucial that they are still correct).</p>",append_str+="<p> The following is the breakdown of what marks you would have received and why you would have gotten them: </p>",append_str+=`<p style='font-weight:bold;'>Mark: ${all_marks[0]}/10 (${all_marks[1]})</p>`;let MARgRNAseq_degree_display=0,MARgRNAseq_degree_explain="Your gRNA sequence was wrong and not found in the Benchling gRNA outputs. Either you made a typo or this answer was not correct and did not contain the target cut site within an acceptable range.";MARgRNAseq&&(1===MARgRNAseq_degree?(MARgRNAseq_degree_display=2,MARgRNAseq_degree_explain="This means your answer was correct and you received full marks."):2===MARgRNAseq_degree?(MARgRNAseq_degree_display=1,MARgRNAseq_degree_explain="This means your sequence was partially correct as it contains the target sequence within a 20bp range but was not optimal. One mark."):3===MARgRNAseq_degree&&(MARgRNAseq_degree_display=.5,MARgRNAseq_degree_explain="This means your sequence was not wrong (therefore was still correct) but there were better options out there. I recommend you try this practice assignment again. Still worth some marks though (half a mark)."));let MARPAMseq_display=0,MARPAMseq_explain="Your PAM sequence was wrong and not found relative to your gRNA sequence. Either you made a typo or this answer was not correct. Either it contained the cut site within the PAM site or it was not an NGG or NAG PAM site (SciGrade only accepts either of those two PAM sites).";MARPAMseq&&(MARPAMseq_display=2,MARPAMseq_explain="This means your answer was correct and you received full marks.");let MAROffTarget_degree_display=0,MAROffTarget_degree_explain="Your off-target score was wrong. Either it was not above/within the optimal range (or above 35) or the last-resort option.";MAROffTarget&&(1===MAROffTarget_degree?(MAROffTarget_degree_display=2,MAROffTarget_degree_explain="This means your answer was correct while above/within the optimal and you received full marks."):2===MAROffTarget_degree?(MAROffTarget_degree_display=1,MAROffTarget_degree_explain="This means your answer was technically correct as its on-target value was above 35."):3===MAROffTarget_degree&&(MAROffTarget_degree_display=.5,MAROffTarget_degree_explain="This means your answer was partially correct as it was found to be your only option is solely based on the target region range you selected."));let MARF1primers_display=0,f1Options="";for(let i=0;i<possible_F1_primers.length;i+=1)f1Options+=possible_F1_primers[i],i===possible_F1_primers.length-1?f1Options+=".":f1Options+=", ";let MARF1primers_explain=`Your F1 primer sequence was incorrectly matched to one of the following sequences generated based on your gRNA sequence inputted: ${f1Options}`;MARF1primers&&(MARF1primers_display=2,MARF1primers_explain="This means your answer was correct and you received full marks.");let MARR1primers_display=0,r1Options="";for(let i=0;i<possible_R1_primers.length;i+=1)r1Options+=possible_F1_primers[i],i===possible_R1_primers.length-1?r1Options+=".":r1Options+=", ";let MARR1primers_explain=`Your R1 primer sequence was incorrectly matched to one of the following sequences generated based on your gRNA sequence inputted: ${r1Options}`;MARR1primers&&(MARR1primers_display=2,MARR1primers_explain="This means your answer was correct and you received full marks."),append_str+="<div class='card about'>",append_str+="<div class='card-header' id='gRNACard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#gRNAOutput' aria-expanded='false' aria-controls='gRNAOutput'>",append_str+=`gRNA Strand Sequence: ${MARgRNAseq_degree_display}/2`,append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='gRNAOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+=`<p> For gRNA Strand Sequence, you put down "${all_answers[0]}" which gave you the mark ${MARgRNAseq_degree_display}.</p>`,append_str+=MARgRNAseq_degree_explain,append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#mainContainer").append(append_str),append_str="<div class='card about'>",append_str+="<div class='card-header' id='PAMCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#PAMOutput' aria-expanded='false' aria-controls='PAMOutput'>",append_str+=`gRNA PAM Sequence: ${MARPAMseq_display}/2`,append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='PAMOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+=`<p> For gRNA PAM Sequence, you put down "${all_answers[1]}" which gave you the mark ${MARPAMseq_display}.</p>`,append_str+=MARPAMseq_explain,append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#mainContainer").append(append_str),append_str="<div class='card about'>",append_str+="<div class='card-header' id='OffTargetCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#OffTargetOutput' aria-expanded='false' aria-controls='OffTargetOutput'>",append_str+=`Off-target Score: ${MAROffTarget_degree_display}/2`,append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='OffTargetOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+=`<p> For Off-Target Score, you put down "${all_answers[4]}" which gave you the mark ${MAROffTarget_degree_display}.</p>`,append_str+=MAROffTarget_degree_explain,append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#mainContainer").append(append_str),append_str="<div class='card about'>",append_str+="<div class='card-header' id='F1PrimerCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#F1PrimerOutput' aria-expanded='false' aria-controls='F1PrimerOutput'>",append_str+=`F1 Primer: ${MARF1primers_display}/2`,append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='F1PrimerOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+=`<p> For F1 Primer, you put down "${all_answers[5]}" which gave you the mark ${MARF1primers_display}.</p>`,append_str+=MARF1primers_explain,append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#mainContainer").append(append_str),append_str="<div class='card about'>",append_str+="<div class='card-header' id='R1PrimerCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#R1PrimerOutput' aria-expanded='false' aria-controls='R1PrimerOutput'>",append_str+=`R1 Primer: ${MARR1primers_display}/2`,append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='R1PrimerOutput' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+=`<p> For R1 Primer, you put down "${all_answers[6]}" which gave you the mark ${MARR1primers_display}.</p>`,append_str+=MARR1primers_explain,append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#mainContainer").append(append_str),append_str="<br>",append_str+="<p> If at any point you wish to dispute marks, please contact your TA or professor once you completed your assignment. If you have found a bug in our SciGrade marking system, please contact your professor or our admin. </p>",append_str+="<br>",append_str+='<p> <button type="button" class="btn btn-primary" onclick="backToAssignments();"> Back to Assignments </button> </p>',$("#mainContainer").append(append_str)}function showNewInput(docCheck,checkFor,docDisplay){document.getElementById(String(docCheck)).value===String(checkFor)?document.getElementById(String(docDisplay)).removeAttribute("hidden"):document.getElementById(String(docDisplay)).setAttribute("hidden",!0)}let completed_assignments=[];function generateCompletedAssignmentList(){completed_assignments=[],student_reg_information[0].student_list[studentParseNum]["assignment-HBB-Marks"]&&(completed_assignments.includes("HBB")||completed_assignments.push("HBB")),student_reg_information[0].student_list[studentParseNum]["assignment-CCR5-Marks"]&&(completed_assignments.includes("CCR5")||completed_assignments.push("CCR5")),student_reg_information[0].student_list[studentParseNum]["assignment-ANKK1-Marks"]&&(completed_assignments.includes("ANKK1")||completed_assignments.push("ANKK1")),student_reg_information[0].student_list[studentParseNum]["assignment-APOE-Marks"]&&(completed_assignments.includes("APOE")||completed_assignments.push("APOE"))}function openAccountManagement(){generateCompletedAssignmentList(),$("#accountManagementBody").empty();let append_str=`\n\t\t<div id='accordion'>\n\t\t\t<p>\n\t\t\t\tHello ${student_reg_information[0].student_list[studentParseNum].name.split(" ")[0]}!\n\t\t\t</p>\n\t\t</div>\n\t\t`;$("#accountManagementBody").append(append_str),append_str=`\n\t\t<div class='card about'>\n\t\t\t<div class='card-header' id='assignmentCard'>\n\t\t\t\t<h5 class='mb-0'>\n\t\t\t\t\t<button class='btn btn-link' data-toggle='collapse' data-target='#completedAssignments' aria-expanded='true' aria-controls='completedAssignments'>\n\t\t\t\t\t\tCompleted assignments:\n\t\t\t\t\t</button>\n\t\t\t\t</h5>\n\t\t\t</div>\n\n\t\t\t<div id='completedAssignments' class='collapse show' aria-labelledby='headingOne' data-parent='#accordion'>\n\t\t\t\t<div class='card-body'>\n\t\t\t\t\t${completed_assignments.length>0?`\n\t\t\t\t\t\t\t<p>You have completed the following assignments: <p>\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t${completed_assignments.map((assignment=>`<li>${assignment}</li>`)).join("")}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t`:"\n\t\t\t\t\t\t\t<p> You have not completed any assignments yet. </p>\n\t\t\t\t\t\t\t"}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,$("#accountManagementBody").append(append_str);const classList=student_reg_information[0].class_list;if(["admin","TA"].includes(student_reg_information[0].student_list[studentParseNum].type)){append_str=`<br>\n\t\t\t<p>\n\t\t\t\t<b> Oh wait! </b> Hello ${student_reg_information[0].student_list[studentParseNum].type}! Would you like to download student marks?\n\t\t\t</p>`,append_str+='<label for="DownloadClass">Choose class: </label>',append_str+='<select id="DownloadClass" class="form-control" style="margin-bottom: 1%">';for(const key in classList)key&&(append_str+=`<option value="${key}" id="${key}" tag="assignment">${key}</option>\n`);append_str+="</select>",append_str+='<p style="text-align: center;"> <button type="button" class="btn btn-primary" onclick="generateHiddenStudentDownload(document.getElementById(\'DownloadClass\').value, true);"> Download Marks </button>',append_str+='<button type="button" class="btn btn-primary" onclick="generateHiddenStudentDownload(document.getElementById(\'DownloadClass\').value, false);" style="margin-left: 2%;"> Download Raw Marks </button> </p>',$("#accountManagementBody").append(append_str)}if("TA"===student_reg_information[0].student_list[studentParseNum].type||"admin"===student_reg_information[0].student_list[studentParseNum].type){append_str="<p> <b> ADMIN POWER! </b> <p>",append_str+="<div class='card about'>",append_str+="<div class='card-header' id='studentCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#addStudents' aria-expanded='false' aria-controls='addStudents' onclick='showNewInput(\"InputClassMultiple\", \"newClass\", \"InputNewClassMultiple\")'>",append_str+="Create new class: ",append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='addStudents' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+="<p style='font-weight: bold;'> If you would like to create a  new class, just fill the form below: ",append_str+="<form>",append_str+='<div class="form-group">',append_str+='<label for="InputClassMultiple" style="font-weight: bold;">Create class name: </label>',append_str+='<select id="InputClassMultiple" class="form-control" style="margin-bottom: 1%" disabled>',append_str+='<option value="newClass" id="newClassMultiple" tag="assignment" >New Class</option>\n',append_str+="</select>",append_str+='<input class="form-control" id="InputNewClassMultiple" placeholder="HMB396 - Winter (NOTE: Spaces will be deleted once you submit so use capital letters to separate words)" hidden>',append_str+='<small id="InputClassHelp" class="form-text text-muted">Choose class students will be added to or create a new class. Example of a new class: HMB396 - Winter - 2019 (NOTE: Spaces will be deleted once you submit so use capital letters to separate words)</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="InputStudentNumber" style="font-weight: bold;">Input student numbers: </label>',append_str+='<textarea class="form-control" id="StudentNumbers" rows="4" placeholder="1234567890, 1003817535, 1113315545"></textarea>',append_str+='<small id="InputStudentNumberHelp" class="form-text text-muted">Input student numbers, separated by commas, new lines and/or tab indentation (BEWARE OF TYPOS!)</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="InputStudentUmail" style="font-weight: bold;">Input student University email: </label>',append_str+='<textarea class="form-control" id="StudentUmails" rows="4" placeholder="john.doe@mail.utoronto.ca, sarah.cat@.mail.utoronto.ca, alexander.macadonia@utoronto.ca"></textarea>',append_str+='<small id="InputStudentUmailUmail" class="form-text text-muted">Input student University associated email in the same order of the student numbers, separated by commas, new lines and/or tab indentation (BEWARE OF TYPOS!)</small>',append_str+="</div>",append_str+="</form>",append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#accountManagementBody").append(append_str),append_str="<div class='card about'>",append_str+="<div class='card-header' id='addTACard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#addTA' aria-expanded='true' aria-controls='addTA'>",append_str+="Add single user: ",append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='addTA' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+="<p style='font-weight: bold;'>If you would like to add a single user (students, TAs or admins), please fill in the form below. Please note, this will default the user as a student. Only admins will be able to create new TAs or admins</p>",append_str+="<form>",append_str+='<div class="form-group">',append_str+='<label for="InputClassSingle" style="font-weight: bold;">Choose class: </label>',append_str+='<select id="InputClassSingle" class="form-control" style="margin-bottom: 1%;">';for(const key in classList)key&&(append_str+=`<option value="${key}" id="${key}" tag="assignment">${key}</option>\n`);append_str+="</select>",append_str+='<small id="InputClassSingleHelp" class="form-text text-muted">Choose class TA will be added.</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="InputStudentNumber" style="font-weight: bold;">User\'s number</label>',append_str+='<input class="form-control" id="StudentNumber" placeholder="1234567890" maxlength="10">',append_str+='<small id="InputStudentNumberHelp" class="form-text text-muted">The user\'s access number (like a student or employee number)</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="InputStudentUmail" style="font-weight: bold;">User\'s umail</label>',append_str+='<input type="email" class="form-control" id="StudentUmail" placeholder="first.last@mail.utoronto.ca">',append_str+='<small id="InputStudentNumberHelp" class="form-text text-muted">The user\'s University associated email</small>',append_str+="</div>",append_str+="</form>",append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#accountManagementBody").append(append_str)}if("admin"===student_reg_information[0].student_list[studentParseNum].type){append_str="<div class='card about'>",append_str+="<div class='card-header' id='modifyCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#modifyControls' aria-expanded='true' aria-controls='modifyControls' onclick='ChangeDOMInnerhtml(\"CurrentOffTarget\", \"Current off-target marking is set to: \" + student_reg_information[0][\"classMarkingMod\"][document.getElementById(\"ClassModChange\").value][0])'>",append_str+="Modify marking controls: ",append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='modifyControls' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+="<p style='font-weight: bold;'>If you would like to change a class's off-target optimal goal, you can do that here</p>",append_str+='<div class="form-group">',append_str+='<label for="ClassModChange" style="font-weight: bold;">Choose class: </label>',append_str+="<select id=\"ClassModChange\" class=\"form-control\" style=\"margin-bottom: 1%;\" onchange=\"ChangeDOMInnerhtml('CurrentOffTarget', 'Current off-target marking is set to: ' + student_reg_information[0]['classMarkingMod'][document.getElementById('ClassModChange').value][0])\">";for(const key in classList)key&&(append_str+=`<option value="${key}" id="${key}" tag="assignment">${key}</option>\n`);append_str+="</select>",append_str+='<small id="ClassModChangeHelp" class="form-text text-muted">Choose the class for which you are modifying marking scheme for.</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<p style="font-weight: bold;">Modify controls for: </p>',append_str+='<label for="SelectModifyControls">Off-Target Marking: </label>',append_str+='<p id="CurrentOffTarget">Current off-target marking is set to: </p>',append_str+='<select id="SelectModifyControls" class="form-control" onchange="showNewInput(\'SelectModifyControls\', \'Custom\', \'InputModifyControls\')" style="margin-bottom: 1%">',append_str+='<option value="Optimal" id="Optimal" tag="assignment">Optimal</option>\n',append_str+='<option value="Custom" id="CustomOffTarget" tag="assignment">Custom</option>\n',append_str+="</select>",append_str+='<input class="form-control" id="InputModifyControls" type="number" step="0.01" min="0.01" max="100" placeholder="Insert number between 0.01 and 100" hidden>',append_str+='<small id="InputModifyControlsHelp" class="form-text text-muted">Choose how you want the off-target score to be marked. Optimal is Min_optimal = Max_range - (Max_range * 0.2) if below 80 (if below, optimal = 80). Custom value can be any number between 0.01 and 100 which will be the new custom "optimal" value for your class.</small>',append_str+="</div>",append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#accountManagementBody").append(append_str),append_str="<div class='card about'>",append_str+="<div class='card-header' id='typeCard'>",append_str+="<h5 class='mb-0'>",append_str+="<button class='btn btn-link' data-toggle='collapse' data-target='#typeControl' aria-expanded='true' aria-controls='typeControl' onclick=\"UpdateStudentList(document.getElementById('ClassChange').value); UpdateChooseUser('ClassUserChange');\">",append_str+="Change a user's account type: ",append_str+="</button>",append_str+="</h5>",append_str+="</div>",append_str+="<div id='typeControl' class='collapse' aria-labelledby='headingOne' data-parent='#accordion'>",append_str+="<div class='card-body'>",append_str+="<p style='font-weight: bold;'>If you would like to change a user's account type (to TA or admin or back to student), you can do that below</p>",append_str+='<div class="form-group">',append_str+='<label for="ClassChange" style="font-weight: bold;">Choose class: </label>',append_str+='<select id="ClassChange" class="form-control" style="margin-bottom: 1%;" onchange="UpdateStudentList(document.getElementById(\'ClassChange\').value); UpdateChooseUser(\'ClassUserChange\');">';for(const key in classList)key&&(append_str+=`<option value="${key}" id="${key}" tag="assignment">${key}</option>\n`);append_str+="</select>",append_str+='<small id="ClassChangeHelp" class="form-text text-muted">Choose the class for which the user belongs to.</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="ClassUserChange" style="font-weight: bold;">Choose user: </label>',append_str+='<select id="ClassUserChange" class="form-control" style="margin-bottom: 1%;" onchange="">',append_str+="</select>",append_str+='<small id="ClassUserChangeHelp" class="form-text text-muted">Choose the user for which you change their account type for.</small>',append_str+="</div>",append_str+='<div class="form-group">',append_str+='<label for="ClassTypeChange" style="font-weight: bold;">Choose type: </label>',append_str+='<select id="ClassTypeChange" class="form-control" style="margin-bottom: 1%;" onchange="">',append_str+='<option value="Student" id="Student" tag="userType">Student</option>\n',append_str+='<option value="TA" id="TA" tag="userType">TA</option>\n',append_str+='<option value="admin" id="admin" tag="userType">admin</option>\n',append_str+="</select>",append_str+='<small id="ClassTypeChangeHelp" class="form-text text-muted">Choose the type for which you want the user to become.</small>',append_str+="</div>",append_str+="<br>",append_str+="</div>",append_str+="</div>",append_str+="</div>",$("#accountManagementBody").append(append_str)}append_str="</div>",$("#accountManagementBody").append(append_str),$("#accountModal").modal("show")}function UpdateChooseUser(domUser){ClearSelectOptions(domUser);for(const key in updatedListOfStudents)updatedListOfStudents[key]&&AddToOptions(domUser,key,updatedListOfStudents[key])}function AddToOptions(domID,optionsValue,optionsInner){const dom=document.getElementById(domID),option=document.createElement("option");option.value=optionsValue,option.innerHTML=optionsInner,dom.appendChild(option)}function ClearSelectOptions(domID){const dom=document.getElementById(domID);for(;dom.options.length>0;)dom.options.remove(0)}let updatedListOfStudents={};function UpdateStudentList(className){updatedListOfStudents={};const studentList=student_reg_information[0].student_list;for(const student of studentList)student.studentClass===className&&(updatedListOfStudents[student.name]=`${student.name} - ${student.type}`)}function ChangeDOMInnerhtml(domID,changeTo){document.getElementById(domID).innerHTML=changeTo}const downloadIndexTable_start="\t\t<tr>\n\t\t\t<th>Student Number</th>\n\t\t\t<th>Name</th>",downloadIndexTable_end="\n\t\t</tr>\n";let downloadIndexTable_fill="";function generateRestOfIndexTable(whichIndexTable,SimpleComplex){return whichIndexTable=downloadIndexTable_start,whichIndexTable+=downloadIndexTable_end}function generateHiddenStudentDownload(whichClass,whichType){if("TA"===student_reg_information[0].student_list[studentParseNum].type||"admin"===student_reg_information[0].student_list[studentParseNum].type){downloadIndexTable_fill=generateRestOfIndexTable(downloadIndexTable_fill,whichType),$("#hiddenDownloadModal_table").empty();const d=new Date;let downloadIndexTable_str="<table id='downloadIndexTable'>\n\t<tbody>\n",captionTitleBegin="SciGrade_studentMark_";whichType||(captionTitleBegin="SciGrade_studentMarkRaw_"),downloadIndexTable_str+=`\t\t<caption>${captionTitleBegin}${student_reg_information[0].student_list[studentParseNum].name.replace(/\s/g,"")}_${d.getFullYear()}-${d.getMonth()}_${d.getDate()}</caption>\n`,downloadIndexTable_str+=downloadIndexTable_fill;const studentRegList=student_reg_information[0].student_list;for(const student of studentRegList)"Student"===student.type&&student.studentClass===whichClass&&(downloadIndexTable_str+="\t\t<tr>\n",downloadIndexTable_str+=`\t\t\t<td>${student.student_number}</td>\n`,downloadIndexTable_str+=`\t\t\t<td>${student.name}</td>\n`,downloadIndexTable_str+="\t\t</tr>\n");downloadIndexTable_str+="\t</tbody>\n</table>",document.getElementById("hiddenDownloadModal_table").innerHTML+=downloadIndexTable_str,$("#hiddenDownloadModal_table").tableToCSV()}else showRegError(7)}function changeInputClass(docCheck,checkFor,docChange,trueChangeValueTo){""!==trueChangeValueTo&&void 0!==trueChangeValueTo||(trueChangeValueTo="undefined Class"),trueChangeValueTo=trueChangeValueTo.replace(/\s/g,""),document.getElementById(docCheck).value===checkFor&&(document.getElementById(docChange).value=trueChangeValueTo)}let all_answers=[],all_outputs=[],all_marks=[],studentAnswers=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Answers`,studentOutputs=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Outputs`,studentMarks=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Marks`;function submitAnswers(){all_answers=[],all_outputs=[],all_marks=[],checkAnswers(),setTimeout((()=>{markAnswers(),studentAnswers=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Answers`,studentOutputs=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Outputs`,studentMarks=`student_list.${studentParseNum}.${loadedMode}-${current_gene}-Marks`,all_answers.push(document?.getElementById("sequence_input")?.value?.trim()||"",document.getElementById("pam_input").value.trim(),document.getElementById("position_input").value,document.getElementById("strand_input").value,document.getElementById("offtarget_input").value,document.getElementById("f1_input").value.trim(),document.getElementById("r1_input").value.trim()),all_outputs.push(MARstrand,MARgRNAseq,MARgRNAseq_degree,MARCutPos,MARPAMseq,MAROffTarget,MAROffTarget_degree,MAROffTarget_aboveOpt,MAROffTarget_above35,MAROffTarget_onlyOption,MARF1primers,MARR1primers),all_marks.push(studentMark,studentMarkPercentage),document.getElementById("options_label").innerHTML="Would you like to see feedback on your answers or start a new assignment?",document.getElementById("seeFeedback").removeAttribute("hidden"),showFeedback(),$("#feedbackButton").click()}),750)}function IfPressEnter(event,toClickButton){13!==event.which&&13!==event.keyCode||$(`#${toClickButton}`).click()}function backToAssignments(){redirectCRISPR(),$("#practice").click()}$((()=>{$("form").submit((()=>!1))}));